{% extends 'base.html' %}

{% block content %}
  <div class="account-container">
    <div class="account-box redirect-box">
      <h2 class="redirect-title">Please Wait...</h2>
      <p class="redirect-message">We are redirecting you to the secure payment page.</p>
      <div class="loading-spinner">
        <div class="spinner-border text-light" role="status">
          <span class="sr-only">Loading...</span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://js.stripe.com/v3/"></script>
  <script>
    const stripe = Stripe('{{ stripe_public_key }}');

    window.onload = function () {
      fetch('/payment/create-checkout-session', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
      })
      .then(function (response) {
        return response.json();
      })
      .then(function (session) {
        if (session.error) {
          alert(session.error);
        } else {
          return stripe.redirectToCheckout({ sessionId: session.sessionId });
        }
      })
      .then(function (result) {
        if (result.error) {
          alert(result.error.message);
        }
      })
      .catch(function (error) {
        console.error('Error:', error);
        alert('An unexpected error occurred.');
      });
    };
  </script>
{% endblock %}